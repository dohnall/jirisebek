(function(){window.mcFileManager={settings:{document_base_url:'',relative_urls:false,remove_script_host:false,use_url_path:true,remember_last_path:'auto',target_elements:'',target_form:'',handle:'file'},setup:function(){var t=this,o,d=document,cp=[];o=d.location.href;if(o.indexOf('?')!=-1)o=o.substring(0,o.indexOf('?'));o=o.substring(0,o.lastIndexOf('/')+1);t.settings.default_base_url=unescape(o);function get(a){var i,n;for(i=0;i<a.length;i++){n=a[i];cp.push(n);if(n.src&&/mcfilemanager\.js/g.test(n.src))return n.src.substring(0,n.src.lastIndexOf('/'))}};o=d.documentElement;if(o&&(o=get(o.getElementsByTagName('script'))))return t.baseURL=o;o=d.getElementsByTagName('script');if(o&&(o=get(o)))return t.baseURL=o;o=d.getElementsByTagName('head')[0];if(o&&(o=get(o.getElementsByTagName('script'))))return t.baseURL=o},relaxDomain:function(){var t=this,p=/(http|https):\/\/([^\/:]+)\/?/.exec(t.baseURL);if(window.tinymce&&tinymce.relaxedDomain){t.relaxedDomain=tinymce.relaxedDomain;return}if(p&&p[2]!=document.location.hostname)document.domain=t.relaxedDomain=p[2].replace(/.*\.(.+\..+)$/,'$1')},init:function(s){this.extend(this.settings,s)},browse:function(s){var t=this;s=s||{};if(s.fields){s.oninsert=function(o){t.each(s.fields.replace(/\s+/g,'').split(/,/),function(v){var n;if(n=document.getElementById(v))t._setVal(n,o.focusedFile.url)})}}this.openWin({page:'index.html'},s)},edit:function(s){this.openWin({page:'edit.html',width:800,height:500},s)},upload:function(s){this.openWin({page:'upload.html',width:550,height:350},s)},createDoc:function(s){this.openWin({page:'createdoc.html',width:450,height:280},s)},createDir:function(s){this.openWin({page:'createdir.html',width:450,height:280},s)},createZip:function(s){this.openWin({page:'createzip.html',width:450,height:280},s)},openWin:function(f,a){var t=this,v,w;t.windowArgs=a=t.extend({},t.settings,a);if(window.mcImageManager){mcImageManager.windowArgs=a}f=t.extend({x:-1,y:-1,width:800,height:500,inline:1},f);if(f.x==-1)f.x=parseInt(screen.width/2.0)-(f.width/2.0);if(f.y==-1)f.y=parseInt(screen.height/2.0)-(f.height/2.0);if(f.page)f.url=t.baseURL+'/../index.php?type=fm&page='+f.page;if(a.session_id)f.url+='&sessionid='+a.session_id;if(a.custom_data)f.url+='&custom_data='+escape(a.custom_data);if(t.relaxedDomain)f.url+='&domain='+escape(t.relaxedDomain);if(a.custom_query)f.url+=a.custom_query;if(a.target_frame){if(v=frames[a.target_frame])v.document.location=f.url;if(v=document.getElementById(a.target_frame))v.src=f.url;return}if(window.tinymce&&tinyMCE.activeEditor)return tinyMCE.activeEditor.windowManager.open(f,a);if(window.jQuery&&jQuery.WindowManager)return jQuery.WindowManager.open(f,a);w=window.open(f.url,'mcFileManagerWin','left='+f.x+',top='+f.y+',width='+f.width+',height='+f.height+',scrollbars='+(f.scrollbars?'yes':'no')+',resizable='+(f.resizable?'yes':'no')+',statusbar='+(f.statusbar?'yes':'no'));try{w.focus()}catch(ex){}},each:function(o,f,s){var n,l;if(o){s=s||o;if(o.length!==undefined){for(n=0,l=o.length;n<l;n++)f.call(s,o[n],n,o)}else{for(n in o){if(o.hasOwnProperty(n))f.call(s,o[n],n,o)}}}},extend:function(){var k,a=arguments,t=a[0],i,v;for(i=1;i<a.length;i++){if(v=a[i]){for(k in v)t[k]=v[k]}}return t},open:function(a,b,c,d,s){var t=this,el;s=s||{};if(!s.url&&document.forms[a]&&(el=document.forms[a].elements[b.split(',')[0]]))s.url=el.value;if(!d){s.oninsert=function(o){var e,i,v,f=o.focusedFile;v=b.replace(/\s+/g,'').split(',');for(i=0;i<v.length;i++){if(e=document.forms[a][v[i]])t._setVal(e,f.url)}}}else{if(typeof(d)=='string')d=window[d];s.oninsert=function(o){d(o.focusedFile.url,o)}}t.browse(s)},filebrowserCallBack:function(a,u,b,w,c){var t=mcFileManager,i,hl,fo,s={};if(window.mcImageManager&&!c){hl=mcImageManager.settings.handle;hl=hl.split(',');for(i=0;i<hl.length;i++){if(b==hl[i])fo=1}if(fo&&mcImageManager.filebrowserCallBack(a,u,b,w,1))return}t.each(tinyMCE.activeEditor?tinyMCE.activeEditor.settings:tinyMCE.settings,function(v,k){if(k.indexOf('filemanager_')===0)s[k.substring(12)]=v});t.browse(t.extend(s,{url:w.document.forms[0][a].value,relative_urls:0,oninsert:function(o){var f,u,na;f=w.document.forms[0];u=o.focusedFile.url;inf=o.focusedFile.custom;if(typeof(TinyMCE_convertURL)!="undefined")u=TinyMCE_convertURL(u,null,true);else if(tinyMCE.convertURL)u=tinyMCE.convertURL(u,null,true);else u=tinyMCE.activeEditor.convertURL(u,null,true);if(inf.custom&&inf.custom.description){na=['alt','title','linktitle'];for(i=0;i<na.length;i++){if(f.elements[na[i]])f.elements[na[i]].value=inf.custom.description}}t._setVal(f[a],u);w=null}}));return true},_setVal:function(n,v){n.value=v;try{n.onchange()}catch(e){}}};mcFileManager.setup();mcFileManager.relaxDomain();var g={getInfo:function(){return{longname:'MCFileManager PHP',author:'Moxiecode Systems AB',authorurl:'http://tinymce.moxiecode.com',infourl:'http://tinymce.moxiecode.com/plugins_filemanager.php',version:"3.1.4"}},convertURL:function(u){if(window.TinyMCE_convertURL)return TinyMCE_convertURL(u,null,true);if(tinyMCE.convertURL)return tinyMCE.convertURL(u,null,true);return tinyMCE.activeEditor.convertURL(u,null,true)},replace:function(t,d,e){var i,r;if(typeof(t)!='string')return t(d,e);function get(d,s){for(i=0,r=d,s=s.split('.');i<s.length;i++)r=r[s[i]];return r};t=''+t.replace(/\{\$([^\}]+)\}/g,function(a,b){var l=b.split('|'),v=get(d,l[0]);if(l.length==1&&e&&e.xmlEncode)v=e.xmlEncode(v);for(i=1;i<l.length;i++)v=e[l[i]](v,d,b);return v});t=t.replace(/\{\=([\w]+)([^\}]+)\}/g,function(a,b,c){return get(e,b)(d,b,c)});return t}};if(window.tinymce){tinymce.create('tinymce.plugins.FileManagerPlugin',{init:function(a,b){var t=this;t.editor=a;t.url=b;mcFileManager.baseURL=b+'/js';a.settings.file_browser_callback=mcFileManager.filebrowserCallBack;mcFileManager.settings.handle=a.getParam('filemanager_handle',mcFileManager.settings.handle);a.addCommand('mceInsertFile',function(u,v){var s={};tinymce.each(tinyMCE.activeEditor.settings,function(v,k){if(k.indexOf('filemanager_')===0)s[k.substring(12)]=v});mcFileManager.browse(tinymce.extend(s,{oninsert:function(o){var u,bm;if(bm=a.windowManager.bookmark)a.selection.moveToBookmark(bm);if(!a.selection.isCollapsed()){a.execCommand("createlink",false,"javascript:mce_temp_url();");tinymce.grep(a.dom.select('a'),function(n){if(n.href=='javascript:mce_temp_url();'){u=g.convertURL(o.focusedFile.url);n.href=u;a.dom.setAttrib(n,'mce_href',u)}})}else{a.execCommand('mceInsertContent',false,g.replace(a.getParam('filemanager_insert_template','<a href="{$url}">{$name}</a>'),o.focusedFile,{urlencode:function(v){return escape(v)},xmlEncode:function(v){return tinymce.DOM.encode(v)}}))}}},v))})},getInfo:function(){return g.getInfo()},createControl:function(n,a){var t=this,c,ed=t.editor,v;switch(n){case'insertfile':v=ed.getParam('filemanager_insert_template');if(v instanceof Array){c=a.createMenuButton('insertfile',{title:'filemanager_insertfile_desc',image:t.url+'/pages/fm/img/insertfile.gif',icons:false});c.onRenderMenu.add(function(c,m){tinymce.each(v,function(v){m.add({title:v.title,onclick:function(){ed.execCommand('mceInsertFile',false,v)}})})})}else{c=a.createButton('insertfile',{title:'filemanager_insertfile_desc',image:t.url+'/pages/fm/img/insertfile.gif',onclick:function(){ed.execCommand('mceInsertFile',false,{template:v})}})}return c}return null}});tinymce.PluginManager.add('filemanager',tinymce.plugins.FileManagerPlugin);tinymce.ScriptLoader.load((tinymce.PluginManager.urls['filemanager']||tinymce.baseURL+'/plugins/filemanager')+'/language/index.php?type=fm&format=tinymce_3_x&group=tinymce&prefix=filemanager_')}if(window.TinyMCE_Engine){var h={setup:function(){var b=(window.realTinyMCE||tinyMCE).baseURL;mcFileManager.baseURL=b+'/plugins/filemanager/js';document.write('<script type="text/javascript" src="'+b+'/plugins/filemanager/language/index.php?type=fm&format=tinymce&group=tinymce&prefix=filemanager_"></script>')},initInstance:function(a){a.settings.file_browser_callback='mcFileManager.filebrowserCallBack';mcFileManager.settings.handle=tinyMCE.getParam('filemanager_handle',mcFileManager.settings.handle)},getControlHTML:function(a){switch(a){case"insertfile":return tinyMCE.getButtonHTML(a,'lang_filemanager_insertfile_desc','{$pluginurl}/pages/fm/img/insertfile.gif','mceInsertFile',false)}return""},getInfo:function(){return g.getInfo()},execCommand:function(a,b,c,d,v){var e=tinyMCE.getInstanceById(a);if(c=='mceInsertFile'){mcFileManager.browse(tinyMCE.extend({path:tinyMCE.getParam("filemanager_path"),rootpath:tinyMCE.getParam("filemanager_rootpath"),remember_last_path:tinyMCE.getParam("filemanager_remember_last_path"),custom_data:tinyMCE.getParam("filemanager_custom_data"),insert_filter:tinyMCE.getParam("filemanager_insert_filter"),oninsert:function(o){var u,nl,i;if(!e.selection.isCollapsed()){e.execCommand("createlink",false,"javascript:mce_temp_url();");nl=tinyMCE.selectElements(e.getBody(),'A',function(n){return tinyMCE.getAttrib(n,'href')=="javascript:mce_temp_url();"});for(i=0;i<nl.length;i++){u=g.convertURL(o.focusedFile.url);nl[i].href=u;nl[i].setAttribute('mce_href',u)}}else{e.execCommand('mceInsertContent',false,g.replace(tinyMCE.getParam('filemanager_insert_template','<a href="{$url}">{$name}</a>'),o.focusedFile,{urlencode:function(v){return escape(v)},xmlEncode:function(v){return tinyMCE.xmlEncode(v)}}))}}},v));return true}return false}};h.setup();tinyMCE.addPlugin('filemanager',h)}})();